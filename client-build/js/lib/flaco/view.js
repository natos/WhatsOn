define(["config/app","modules/app"],function(a,b){function c(a){var b=e(a).replace(/\//g,"-");return b=b==="-"?"":b,a.name+b+"-template"}function d(a){return"#"+c(a)}function e(a){return a.State&&a.State.parts?"/"+a.State.parts.join("/"):""}function f(a){return $(d(a))[0]}function g(a){return $("#"+a.name+"-content")[0]}function h(a){var b="/"+a.name+e(a);$.get(b,function(b){j(a,b),i(a)})}function i(b){a._content.innerHTML=$(d(b)).text();var c={},e,f,g,h,e=$("head").find("meta");e.forEach(function(a){g=$(a).attr("property"),h=$(a).attr("content"),g&&h&&(c[g]={property:g,content:h,element:a})});var i=$("#content").find("meta");i.forEach(function(a){g=$(a).attr("property"),h=$(a).attr("content"),c[g]&&c[g].content!==h&&(c[g].element.content=h)}),b.render()}function j(a,b){var b=b||$("#content").html(),e=f(a)?$(d(a)):$(v).attr("id",c(a)).appendTo("#templates");e.text(b)}function k(a){if(g(a)){a.render();return}f(a)?i(a):(console.log("template doesn't exist, fetch template"),h(a))}function l(a){j(a)}function m(c){function d(a,b){if(!i)return;var c,d;for(c in i)i.hasOwnProperty(c)&&(d=i[c],typeof d[a]=="function"&&d[a].apply(d,b))}function e(e){function g(a){return m[a]}function i(){var a=w.call(arguments,0);return e===t&&(f.State=a[0]),k&&b.emit(k,f,a),j&&j.apply(f,a),d.call(f,e,a),l&&b.emit(l,f,a),this}var j=c[e],k=a[n+"_"+h.present(e)],l=a[n+"_"+h.past(e)],m={};m[t]=function(){return i.apply(f,arguments)},m[s]=function(){return i.apply(f,arguments)},m[u]=function(){return i.apply(f,arguments)},f[e]=g(e)?m[e]:c[e]}var f={},g,h=function(){function a(a,b,c,d){return/er$/.test(a)?b+c+"ing":b+"ing"}function b(a,b,c,d){return/er$/.test(a)?b+c+"ed":b+"ed"}var c=/^(\w+)(e|er)$/gi;return{present:function(b){return b.replace(c,a).toUpperCase()},past:function(a){return a.replace(c,b).toUpperCase()}}}(),i=c.components;for(g in c)e(g);return f}var n="VIEW",o="name",p="method",q="present",r="past",s="render",t="initialize",u="finalize",v='<script type="text/template">',w=Array.prototype.slice;return b.on(a.VIEW_INITIALIZED,k),b.on(a.VIEW_FINALIZING,l),m})