define(["config/app","config/grid","config/channel","modules/app","models/channel","lib/flaco/view","components/timebar","components/channelbar","utils/convert","utils/dom"],function(a,b,c,d,e,f,g,h,i,j){function k(){d.emit(b.GRID_MOVED),J&&clearTimeout(J),J=setTimeout(function(){d.emit(b.GRID_FETCH_EVENTS)},b.EXECUTION_DELAY)}function l(a){if(a&&a.changedTouches&&a.changedTouches.length==1){var b=a.changedTouches[0].pageX,c=a.changedTouches[0].pageY,d=new Date;if(E&&F&&G){var e=(d.valueOf()-G.valueOf())/1e3;H=(b-E)/e,I=(c-F)/e}E=b,F=c,G=d}}function m(a){if(Math.abs(H)>200||Math.abs(I)>200)A&&(A.style.display="none"),B&&(B.style.display="none")}function n(){L&&clearTimeout(L),L=setTimeout(function(){A&&(A.style.display="block"),B&&(B.style.display="block")},100)}function o(a){if(typeof a=="undefined")return;if(a.render){while(C.firstChild)C.removeChild(C.firstChild);C.appendChild(a.render),D=document.getElementById("timer-ticker"),K.tick(),d.emit(b.GRID_RENDERED)}}function p(){var a=j.create("style");a.id="grid-styles",document.getElementsByTagName("HEAD")[0].appendChild(a),b.CHANNELS_COUNT=e[c.GROUPS][e[c.SELECTED_GROUP]].length,b.VIEWPORT_WIDTH_HOURS=(document.body.clientWidth-b.CHANNEL_BAR_WIDTH)/b.HOUR_WIDTH,b.GRID_HEIGHT=b.ROW_HEIGHT*b.CHANNELS_COUNT,b.GRID_WIDTH=b.HOUR_WIDTH*24;var d=[];d.push(".nav { z-index: 1; } @media screen and (min-width:640px) { .nav { z-index: 100; } }"),d.push("#grid-container {height:"+b.GRID_HEIGHT+"px;width:"+b.GRID_WIDTH+"px;margin-left:"+b.CHANNEL_BAR_WIDTH+"px;margin-top:"+b.TIMEBAR_HEIGHT+"px;}"),d.push("#grid-container .grid-event {height:"+b.ROW_HEIGHT+"px;}"),d.push("#channels-bar li {height:"+b.ROW_HEIGHT+"px;}"),d.push("#time-bar-list {width:"+b.GRID_WIDTH+"px;margin-left:"+b.CHANNEL_BAR_WIDTH+"px;}"),d.push("#time-bar-list li {width:"+b.HOUR_WIDTH+"px;}"),d.push(".channel-container {height:"+b.ROW_HEIGHT+"px;}"),a.innerHTML=d.join("\n")}function q(){var a=document.getElementById("grid-styles");document.getElementsByTagName("head")[0].removeChild(a)}function r(){var a=window.pageXOffset/b.HOUR_WIDTH,c=new Date(b.zeroTime.valueOf()+a*b.MILLISECONDS_IN_HOUR-b.VIEWPORT_WIDTH_HOURS/4*b.MILLISECONDS_IN_HOUR),d=new Date(b.zeroTime.valueOf()+a*b.MILLISECONDS_IN_HOUR+b.VIEWPORT_WIDTH_HOURS*b.MILLISECONDS_IN_HOUR);return{startTime:c,endTime:d}}function s(a){return h.getSelectedChannels(a)}function t(){return K.status=!0,K.clock=setTimeout(K.tick,K.time),this}function u(){if(!K.status)return;if(typeof D=="undefined")return;return D.style.left=i.timeToPixels((new Date).valueOf())+"px",K.stop(),K.start(),this}function v(){return K.status=!1,K.clock=clearTimeout(K.clock),this}function w(){return a._win.addEventListener("resize",k),a._win.addEventListener("scroll",k),a._win.addEventListener("touchmove",k),a._win.addEventListener("touchstart",l),a._win.addEventListener("touchmove",l),a._win.addEventListener("scroll",n),a._win.addEventListener("touchstart",n),a._win.addEventListener("touchend",m),d.on(b.MODEL_CHANGED,o),this}function x(){return p(),C=document.getElementById("grid-container"),B=document.getElementById("channels-bar"),A=document.getElementById("time-bar"),K.start().tick(),this}function y(){return q(),a._win.removeEventListener("resize",k),a._win.removeEventListener("scroll"),a._win.removeEventListener("touchmove"),d.off(b.MODEL_CHANGED,o),this}var z="grid",A,B,C,D,E,F,G,H=0,I=0,J,K={clock:void 0,time:5e3,status:!1,start:t,tick:u,stop:v},L;return new f({name:z,initialize:w,finalize:y,render:x,getSelectedChannels:s,getSelectedTime:r,components:{channelbar:h,timebar:g}})})