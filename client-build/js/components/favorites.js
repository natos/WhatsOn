define(["config/app","config/user","config/channel","modules/app","models/user","models/channel"],function(a,b,c,d,e,f){function g(a){var c;a||(a=e);if(typeof a=="undefined"){console.log("Warning!","Favorites","No model, skip rendering");return}a["facebook-status"]&&(c=a["facebook-status"].status===b.CONNECTED,$("#dashboard-invitation").toggle(!c),$("#top-lists").toggle(c)),a[n]&&i(a[n]),a[o]&&h(a[o]);return}function h(b){var c,d,e,f=$(".favorite-channels"),g=[];for(c in b)d=b[c].data.tv_channel,e=d.url.split(a.ROOT_URL+"channel/")[1],g.push(e);g.length>0?f.addClass("loading").load("/dashboard/on-now/"+g.join("|"),function(a,b,c){f.removeClass("loading")}):f.html($("#empty-favorite-channels-template").text())}function i(b){var c,d,e,f={},g=[],h,i,j,k=$(".favorite-programmes");for(c in b)d=b[c].data.tv_show,e=d.url.split(a.ROOT_URL+"programme/")[1],h=q.clone().attr("href","/programme/"+e).attr("class","programme").html(d.title),i=p.clone().append(h),f[e]=i,g.push(e);g.length>0?(k.addClass("loading").html($("#favorite-programmes-template").text()),j=$(".favorite-programmes .programmes"),$.getJSON("/programme/"+g.join("-")+"/next.json",function(a,b,c){for(var d in a){var e=a[d].programme.id;f[e].prepend("<span>"+a[d].prettyDate+"</span>").appendTo(j)}k.removeClass("loading"),j.find("li").length==0&&k.html($("#favorite-programmes-notfound-template").text())})):k.html($("#empty-favorite-programmes-template").text())}function j(){return d.on(b.MODEL_CHANGED,g),this}function k(a){var b=$("#top-lists"),c=$("#dashboard-invitation");return b.hide(),c.hide(),g(e),setTimeout(function(){b.css("display")==="none"&&c.css("display")==="none"&&c.show()},2e3),this}function l(){return d.off(b.MODEL_CHANGED,g),this}var m="favorites",n="favorite-programmes",o="favorite-channels",p=$("<li>"),q=$("<a>");return{name:m,initialize:j,finalize:l,render:k}})