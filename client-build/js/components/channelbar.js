define(["config/app","config/channel","config/grid","config/user","models/channel","models/grid","models/user","modules/app","utils/dom"],function(a,b,c,d,e,f,g,h,i){function j(a){D&&(D.style.top=a.top+"px")}function k(){this.className=""}function l(a){var b,c=a.length;while(c--)channelImg=document.getElementById("channelImg"+a[c]),channelImg.getAttribute("src")||(channelImg.setAttribute("src",channelImg.getAttribute("data-src")),channelImg.className="loading",channelImg.onload=k);channelImg=null}function m(a){if(typeof a=="undefined")return;a.position&&j(a.position),a.selectedChannels&&l(a.selectedChannels)}function n(a){if(typeof a=="undefined")return;a[x]&&v()}function o(a,b){switch(a){case z:p();break;case y:q(b)}}function p(){C.className=C.className===""?"expanded":""}function q(a){var b="upcsocial:tv_channel",c=a.dataset.id,e=a.dataset.url,f=a.getElementsByTagName("i")[0],g=f.className==="icon-star";if(!e)return;g?(f.className="icon-star-empty",h.emit(d.REMOVE_FAVORITE,c)):(f.className="icon-star",h.emit(d.ADD_FAVORITE,b,e))}function r(){return h.on(c.MODEL_CHANGED,m),h.on(d.MODEL_CHANGED,n),h.on(a.ACTION,o),this}function s(){return C.id="channels-bar",C.innerHTML=A.innerHTML,B.appendChild(C),D=document.getElementById("channels-bar-list"),v(),this}function t(){return B.removeChild(C),h.off(c.MODEL_CHANGED,m),h.off(d.MODEL_CHANGED,n),h.off(a.ACTION,o),this}function u(a){var b=window.pageYOffset/c.ROW_HEIGHT,d=b<0?0:Math.floor(b),e=100,f=(window.innerHeight-e)/c.ROW_HEIGHT,g=[],h=0;a||(a=0);for(h=0-a;h<f+a;h++){if(d+h<0||d+h>=E.length)continue;g.push(E[d+h].id)}return g}function v(){E=e[b.GROUPS][e[b.SELECTED_GROUP]],D=document.getElementById("channels-bar-list");var a,c,d,f=E.length,h,j,k,m,n,o,p=i.create("fragment");while(D.firstChild)D.removeChild(D.firstChild);for(d=0;d<f;d++)a=E[d].id,c=E[d].name,o=g[x]?g[x]["http://upcsocial.herokuapp.com/channel/"+a]:!1,k=i.create("img"),k.setAttribute("id","channelImg"+a),k.setAttribute("title",c),k.setAttribute("data-src","http://www.upc.nl"+E[d].logo.href+"?size=medium"),j=i.create("div"),j.className="picture",j.appendChild(k),n=i.create("i"),n.className=o?"icon-star":"icon-star-empty",m=i.create("button"),m.className="favorite",m.setAttribute("data-action",y),m.setAttribute("data-url","http://upcsocial.herokuapp.com/channel/"+a),o&&m.setAttribute("data-id",o.id),m.appendChild(n),h=i.create("li"),h.appendChild(j),h.appendChild(m),p.appendChild(h),o=null,k=null,j=null,n=null,m=null,h=null;D.appendChild(p),l(u()),p=null;return}var w="channelbar",x="favorite-channels",y="TOGGLE-FAVORITE",z="TOGGLE-EDIT-MODE",A=document.getElementById("channelsbar-template"),B=document.getElementById("main"),C=document.createElement("div"),D,E=[];return{name:w,initialize:r,finalize:t,render:s,getSelectedChannels:u}})