define(["config/app","modules/app","utils/dom","/js/lib/history/1.7.1-r2/bundled/html4+html5/native.history.js"],function(a,b,c){function d(){$(".nav").append('<a href="/grid" class="grid"><i class="icon-th"></i><b class="label">TV Gids</b></a>')}function e(){var c=n.getState(),d=n.getShortUrl(c.url);d.slice(0,1)==="/"&&(d=d.slice(1)),d.slice(0,2)==="./"&&(d=d.slice(2)),c.parts=d.split(/[\/\?\&=\#]/gi),c.controller=c.parts?o.apply(c.parts):"",b.emit(a.NAVIGATE,c)}function f(a){var b=$("."+a.name);b[0]&&($(".nav a").removeClass("active"),b.addClass("active"))}function g(d){var e=anchor=d.target,f;f=c.getDataset(e);while(!f.action){if(e===this)break;e=e.parentNode,f=c.getDataset(e)}f.action&&b.emit(a.ACTION,f.action,e);while(!anchor.href){if(anchor===this)break;anchor=anchor.parentNode}anchor.href&&(d.preventDefault(),f=c.getDataset(anchor),j(f,anchor.title,anchor.href))}function h(){return n.Adapter.bind(window,m,e),b.on(a.VIEW_INITIALIZING,f),a._main.addEventListener("click",g,!1),e(),b.allowGrid()&&d(),this}function i(){return n.Adapter.unbind(window,m,e),b.off(a.VIEW_INITIALIZING,f),a._main.removeEventListener("click",g,!1),this}function j(a,b,c){return n.pushState(a,b,c),this}function k(a,b,c){return n.replaceState(a,b,c),this}var l="router",m="statechange",n=window.History,o=Array.prototype.shift;return{name:l,initialize:h,navigate:j}})